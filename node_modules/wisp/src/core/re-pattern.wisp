(ns wisp.core.re-pattern
  (:require [wisp.type.re-pattern :refer [IRePattern RePattern
                                          re-find re-matches re-seq
                                          re-pattern?]]
            [wisp.core.indexed :refer [nth]]
            [wisp.core.protocol :refer [satisfies?]]))


(def regexp? re-pattern?)

(defn re-pattern
  "Returns an instance of RegExp which has compiled the provided string."
  [source]
  (let [matches (re-find #"^(?:\(\?([idmsux]*)\))?(.*)" source)]
    (js/RegExp. (nth matches 2)
                (nth matches 1))))
