(ns wisp.type.nil
  (:require [wisp.interface.meta :refer [IMeta IWithMeta]]
            [wisp.interface.boolean :refer [ICastBoolean]]
            [wisp.interface.equal :refer [IEqual]]
            [wisp.interface.counted :refer [ICounted]]
            [wisp.interface.nil :refer [INil]]
            [wisp.interface.writable :refer [IWritable]]
            [wisp.interface.writer :refer [-append]]))

(def nil? wisp.type.nil/nil?)

(deftype NilWithMetadata
  [metadata]
  INil

  Object
  (valueOf [_] nil)
  (toString [_] "nil")

  IMeta
  (-meta [_] metadata)

  IWithMeta
  (-with-meta [_ new-metadata]
    (NilWithMetadata. new-metadata))

  ICastBoolean
  (->boolean [_] false)

  IWritable
  (-write [_ writer options]
    (-append writer "nil" options))

  IEqual
  (-equal [_ other] (nil? other))

  ICounted
  (-count [_] 0))

(extend-type nil
  INil

  IMeta
  (-meta [_] nil)

  IWithMeta
  (-with-meta [_ metadata]
    (NilWithMetadata. metadata))

  ICastBoolean
  (->boolean [_] false)

  IWritable
  (-write [_ writer options]
    (-append writer "nil" options))

  IEqual
  (-equal [_ other]
    (nil? other))

  ICounted
  (-count [_] 0))
